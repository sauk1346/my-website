# Búsqueda Avanzada usando \$regex 02

- **Base de Datos:** guia04
- **Colleción:** usuarios
- **Json:** [usuarios.json](/inacap/ti3v32/data/usuarios04.json)

## Ejercicio 01
Buscar usuarios cuyo nombre contenga una vocal con tilde (á, é, í, ó, ú)

<Solution>
```js
db.usuarios.find({ nombre: {$regex:/[áíúéó]/i} })
```
</Solution>

## Ejercicio 02
Filtrar usuarios con email que contenga un número

<Solution>
```js
db.usuarios.find({ email:{$regex: /\d/}})
```
</Solution>

## Ejercicio 03
Buscar usuarios con correo institucional que termine en .edu.cl

<Solution>
```js
db.usuarios.find({ "email":{$regex:/\.edu\.cl$/} })
```
</Solution>

## Ejercicio 04
Mostrar usuarios cuya dirección contenga la palabra "Oficina"

<Solution>
```js
db.usuarios.find({ "direccion": {$regex: /Oficina/i} })
```
</Solution>

## Ejercicio 05
Buscar usuarios cuya dirección termine con una palabra de 5 letras

<Solution>
```js
db.usuarios.find({ "direccion":{$regex:/\w{5}$/} })
```
</Solution>

## Ejercicio 06
Filtrar usuarios con comentarios que contengan la palabra "reclamo" o "solicitud"

<Solution>
```js
db.usuarios.find({ "comentarios": {$regex:/reclamo|solicitud/} })
```
</Solution>

## Ejercicio 07
Mostrar usuarios cuyo email tenga tres palabras antes del \@

<Solution>
```js
db.usuarios.find({ "email":{$regex:/\w+\.\w+\.\w+\@/} })
```
</Solution>

## Ejercicio 08
Buscar nombres que comiencen con "Luis" o "Lucía"

<Solution>
```js
db.usuarios.find({ "nombre":{$regex:/^(Luis|Lucía)/i} })
```
</Solution>

## Ejercicio 09
Mostrar direcciones que contengan el término "Depto" o "Piso"

<Solution>
```js
db.usuarios.find({ "direccion":{$regex:/Depto|Piso/i} })
```
</Solution>

## Ejercicio 10
Filtrar usuarios con comentarios que contengan un símbolo especial (\@, \!, \#)

<Solution>
```js
db.usuarios.find({"comentarios":{$regex:/\@\!\#/} })
```
</Solution>

## Ejercicio 11
Buscar usuarios cuya edad sea mayor al doble de la cantidad de etiquetas

<Solution>
```js
db.usuarios.find({
  $expr: {
    $gt: ["$edad", { $multiply: [2, { $size: "$etiquetas" }] }]
  }
})
```
</Solution>

## Ejercicio 12
Mostrar usuarios qu tengan exactamente 3 etiquetas

<Solution>
```js
db.usuarios.find({
  "etiquetas": { $size: 3 }
})
```
</Solution>

## Ejercicio 13
Mostrar usuarios cuya edad corresponda al cálculo 2025 - añoNacimiento 

<Solution>
```js
db.usuarios.find({
  $expr: {
    $eq: [ "$edad", {$subtract: [2025, "$añoNacimiento"] }]
  }
})
```
</Solution>

## Ejercicio 14
Mostrar usuarios con más de dos compras registradas

<Solution>
```js
db.usuarios.find({
  $expr: {
    $gt: [{ $size: "$compras" }, 2]
  }
})
```
</Solution>

## Ejercicio 15
Buscar usuarios registrados durante el año 2023 (usando $expr)

<Solution>
```js
db.usuarios.find({
  $expr: {
    $eq: [ {$year: "$fechaRegistro"}, 2023]
  }
})
```
</Solution>

## Ejercicio 16
Filtrar usuarios cuya comuna y región sean exactamente iguales

<Solution>
```js
db.usuarios.find({
  $expr: {
    $eq: ["$direccion.comuna", "$direccion.region"]
  }
})
```
</Solution>

## Ejercicio 17
Filtrar usuarios que hayan comprado productos con un precio promedio mayor a \$300.000

<Solution>
```js
db.usuarios.find({
  "compras.precio": { $gt: 300000 }
})
```
</Solution>

## Ejercicio 18
Mostrar usuarios que tengan más etiquetas que productos comprados

<Solution>
```js
db.usuarios.find({
  $expr: {
    $gt: [ { $size: "$etiquetas" }, { $size: "$compras" } ]
  }
})
```
</Solution>

## Ejercicio 19
Buscar usuarios que tengan comentarios y etiquetas, y además hayan comprado un "Mouse"

<Solution>
```js
db.usuarios.find({
  "comentarios": { $exists: true, $ne: [] },
  "etiquetas": { $exists: true, $ne: [] },
  "compras.producto": "Mouse"
})
```
</Solution>

## Ejercicio 20
Filtrar usuarios mayores de 40 años con menos de 2 compras registradas

<Solution>
```js
db.usuarios.find({
  "edad": { $gt: 40 },
  $expr: {
    $lt: [{ $size: "$compras" }, 2]
  }
})
```
</Solution>
