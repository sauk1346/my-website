import ExternalLink from '@/components/ui/ExternalLink'

# Actividad MongoDB - Consultas Avanzadas: Universo DC

- **Base de datos:** dcCineDB
- **Colección:** peliculasDC
- **JSON**: <ExternalLink href='/inacap/ti3v32/data/peliculas.json'>peliculas.json</ExternalLink>

## Ejercicio 01
Buscar todas las películas disponibles en streaming.

<details>
    <summary>Solución</summary>
```js
db.peliculasDC.find({ disponible_streaming: true })
```
</details>

## Ejercicio 02
Listar las películas que tengan más de dos géneros.

<details>
    <summary>Solución</summary>
```js
db.peliculasDC.find({ 
    $expr: { 
        $gt: [{ $size: "$generos" }, 2] 
    }
})
```
</details>

## Ejercicio 03
Mostrar las películas dirigidas por 'Zack Snyder'.

<details>
    <summary>Solución</summary>
```js
db.peliculasDC.find({ director: "Zack Snyder" })
```
</details>

## Ejercicio 04
Filtrar películas con una puntuación IMDb mayor a 8.

<details>
    <summary>Solución</summary>
```js
db.peliculasDC.find({ 
    "puntuaciones.IMDb": { $gt: 8 } 
})
```
</details>

## Ejercicio 05
Listar películas que hayan ganado al menos un premio.

<details>
    <summary>Solución</summary>
```js
db.peliculasDC.find({ 
    premios: { $ne: [] } 
})
```
</details>

## Ejercicio 06
Mostrar películas lanzadas después del 2010.

<details>
    <summary>Solución</summary>
```js
db.peliculasDC.find({ 
    anio: { $gt: 2010 } 
})
```
</details>

## Ejercicio 07
Buscar películas con recaudación mundial mayor a 800 millones.

<details>
    <summary>Solución</summary>
```js
db.peliculasDC.find({
    recaudacion_mundial: { $gt: 800000000 } 
})
```
</details>

## Ejercicio 08
Mostrar películas que estén disponibles en HBO Max y Netflix.

<details>
    <summary>Solución</summary>
```js
db.peliculasDC.find({
    plataformas: { $all: ["HBO Max", "Netflix"] }
})
```
</details>

## Ejercicio 09
Listar películas con clasificación diferente a 'PG-13'.

<details>
    <summary>Solución</summary>
```js
db.peliculasDC.find({
    clasificacion: { $ne: "PG-13" }
})
```
</details>

## Ejercicio 10
Filtrar películas que duren más de 150 minutos.

<details>
    <summary>Solución</summary>
```js
db.peliculasDC.find({
    duracion: { $gt: 150 }
})
```
</details>

## Ejercicio 11
Listar películas que tengan al menos 3 actores.

<details>
    <summary>Solución</summary>
```js
db.peliculasDC.find({
    $expr: { 
        $gte: [{ $size: "$actores" }, 3] 
    } 
})
```
</details>

## Ejercicio 12
Mostrar películas que no tengan premios registrados.

<details>
    <summary>Solución</summary>
```js
db.peliculasDC.find({ 
    premios: { $size: 0 } 
})
```
</details>

## Ejercicio 13
Buscar películas que estén en Amazon Prime pero no en HBO Max.

<details>
    <summary>Solución</summary>
```js
db.peliculasDC.find({ 
    plataformas: "Amazon Prime", 
    plataformas: { $nin: ["HBO Max"] } 
})
```
</details>

## Ejercicio 14
Filtrar películas que tengan el género 'Fantasía'.

<details>
    <summary>Solución</summary>
```js
db.peliculasDC.find({ generos: "Fantasía" })
```
</details>

## Ejercicio 15
Mostrar películas donde 'Gal Gadot' sea una de las actrices.

<details>
    <summary>Solución</summary>
```js
db.peliculasDC.find({ actores: "Gal Gadot" })
```
</details>

## Ejercicio 16
Contar cuántas películas fueron dirigidas por cada director.

<details>
    <summary>Solución</summary>
```js
db.peliculasDC.aggregate([
  { $group: { _id: "$director", cantidad: { $sum: 1 } } }
])
```
</details>

## Ejercicio 17
Calcular el promedio de duración de las películas.

<details>
    <summary>Solución</summary>
```js
db.peliculasDC.aggregate([
  { $group: { _id: null, promedio_duracion: { $avg: "$duracion" } } }
])
```
</details>

## Ejercicio 18
Obtener el promedio de puntuación IMDb por año.

<details>
    <summary>Solución</summary>
```js
db.peliculasDC.aggregate([
  { $group: { _id: "$anio", promedio_imdb: { $avg: "$puntuaciones.IMDb" } } }
])
```
</details>

## Ejercicio 19
Listar las películas con recaudación menor al promedio general.

<details>
    <summary>Solución</summary>
```js
db.peliculasDC.aggregate([
  { 
    $group: { 
      _id: null, 
      promedio: { $avg: "$recaudacion_mundial" } 
    }
  },
  {
    $lookup: {
      from: "peliculasDC",
      pipeline: [],
      as: "todas_peliculas"
    }
  },
  { $unwind: "$todas_peliculas" },
  {
    $match: {
      $expr: { $lt: ["$todas_peliculas.recaudacion_mundial", "$promedio"] }
    }
  },
  {
    $replaceRoot: { newRoot: "$todas_peliculas" }
  }
])
```
</details>

## Ejercicio 20
Mostrar las películas cuyo título contenga la palabra 'Wonder'.

<details>
    <summary>Solución</summary>
```js
db.peliculasDC.find({ titulo: /Wonder/ })
```
</details>

## Ejercicio 21
Buscar películas que no tengan el campo 'puntuaciones'.

<details>
    <summary>Solución</summary>
```js
db.peliculasDC.find({ 
    puntuaciones: { $exists: false } 
})
```
</details>

## Ejercicio 22
Mostrar solo el título y año de cada película.

<details>
    <summary>Solución</summary>
```js
db.peliculasDC.find({}, { titulo: 1, anio: 1, _id: 0 })
```
</details>

## Ejercicio 23
Ordenar las películas por recaudación mundial de mayor a menor.

<details>
    <summary>Solución</summary>
```js
db.peliculasDC.find().sort({ recaudacion_mundial: -1 })
```
</details>

## Ejercicio 24
Limitar el resultado a las 5 películas con mayor puntuación en RottenTomatoes.

<details>
    <summary>Solución</summary>
```js
db.peliculasDC.find().sort({ "puntuaciones.RottenTomatoes": -1 }).limit(5)
```
</details>

## Ejercicio 25
Agrupar por plataforma y contar cuántas películas hay en cada una.

<details>
    <summary>Solución</summary>
```js
db.peliculasDC.aggregate([
  { $unwind: "$plataformas" },
  { $group: { _id: "$plataformas", cantidad: { $sum: 1 } } }
])
```
</details>
