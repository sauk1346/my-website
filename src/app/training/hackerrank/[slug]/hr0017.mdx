# Regresión Polinómica: Precios de Oficinas


Charlie quiere comprar espacio de oficina y ha realizado un estudio del área. Ha cuantificado y normalizado varias características del espacio de oficina, y las ha mapeado a valores entre 0 y 1.

Cada fila en la tabla de datos de Charlie contiene estos valores de características seguidos por el precio por metro cuadrado.

Sin embargo, algunos precios faltan. Charlie necesita tu ayuda para predecir los precios faltantes.

Los precios por metro cuadrado son aproximadamente una función polinómica de las características, y se te asigna usar esta relación para predecir los precios faltantes para algunas oficinas.

Los precios por metro cuadrado son aproximadamente una función polinómica de las características en la tabla de obsevación. Este polinomio siempre tiene un orden menor que 4.


## Formato de Entrada

La primera línea contiene dos enteros separados por espacio, $F$ y $N$. Aquí, $F$ es el número de características observadas. $N$ es el número de filas para las cuales se han anotado las características así como el precio por metro cuadrado.

Esto es seguido por una tabla con $F+1$ columnas y $N$ filas, con cada fila en una nueva línea y cada columna separada por un solo espacio. La última columna es el precio por metro cuadrado.

La tabla es inmediatamente seguida por el entero $T$, seguido por $T$ filas que contienen $F$ columnas.

## Restricciones

- $1 \le F \le 5$
- $5 \le N \le 100$
- $1 \le T \le 100$
- $0 \le Price Per Square Foot \le 10^6$
- $0 \le Factor Values \le 1$

## Formato de Salida

$T$ líneas. Cada línea $i$ conteine el precio predicho para el i-ésimo caso de prueba.

## Ejemplo

**Input**
```text
2 100
0.44 0.68 511.14
0.99 0.23 717.1
0.84 0.29 607.91
0.28 0.45 270.4
0.07 0.83 289.88
0.66 0.8 830.85
0.73 0.92 1038.09
0.57 0.43 455.19
0.43 0.89 640.17
0.27 0.95 511.06
0.43 0.06 177.03
0.87 0.91 1242.52
0.78 0.69 891.37
0.9 0.94 1339.72
0.41 0.06 169.88
0.52 0.17 276.05
0.47 0.66 517.43
0.65 0.43 522.25
0.85 0.64 932.21
0.93 0.44 851.25
0.41 0.93 640.11
0.36 0.43 308.68
0.78 0.85 1046.05
0.69 0.07 332.4
0.04 0.52 171.85
0.17 0.15 109.55
0.68 0.13 361.97
0.84 0.6 872.21
0.38 0.4 303.7
0.12 0.65 256.38
0.62 0.17 341.2
0.79 0.97 1194.63
0.82 0.04 408.6
0.91 0.53 895.54
0.35 0.85 518.25
0.57 0.69 638.75
0.52 0.22 301.9
0.31 0.15 163.38
0.6 0.02 240.77
0.99 0.91 1449.05
0.48 0.76 609.0
0.3 0.19 174.59
0.58 0.62 593.45
0.65 0.17 355.96
0.6 0.69 671.46
0.95 0.76 1193.7
0.47 0.23 278.88
0.15 0.96 411.4
0.01 0.03 42.08
0.26 0.23 166.19
0.01 0.11 58.62
0.45 0.87 642.45
0.09 0.97 368.14
0.96 0.25 702.78
0.63 0.58 615.74
0.06 0.42 143.79
0.1 0.24 109.0
0.26 0.62 328.28
0.41 0.15 205.16
0.91 0.95 1360.49
0.83 0.64 905.83
0.44 0.64 487.33
0.2 0.4 202.76
0.43 0.12 202.01
0.21 0.22 148.87
0.88 0.4 745.3
0.31 0.87 503.04
0.99 0.99 1563.82
0.23 0.26 165.21
0.79 0.12 438.4
0.02 0.28 98.47
0.89 0.48 819.63
0.02 0.56 174.44
0.92 0.03 483.13
0.72 0.34 534.24
0.3 0.99 572.31
0.86 0.66 957.61
0.47 0.65 518.29
0.79 0.94 1143.49
0.82 0.96 1211.31
0.9 0.42 784.74
0.19 0.62 283.7
0.7 0.57 684.38
0.7 0.61 719.46
0.69 0.0 292.23
0.98 0.3 775.68
0.3 0.08 130.77
0.85 0.49 801.6
0.73 0.01 323.55
1.0 0.23 726.9
0.42 0.94 661.12
0.49 0.98 771.11
0.89 0.68 1016.14
0.22 0.46 237.69
0.34 0.5 325.89
0.99 0.13 636.22
0.28 0.46 272.12
0.87 0.36 696.65
0.23 0.87 434.53
0.77 0.36 593.86
4
0.05 0.54
0.91 0.91
0.31 0.76
0.51 0.31
```

**Output**
```text
180.38
1312.07
440.13
343.72
```

**Explicación**

Hay dos características que han sido anotadas por Charlie. Hay 100 puntos de datos, para los cuales ha tomado nota de las características y el precio por metro cuadrado (en la última columna).

Al final, hay cuatro filas donde él conoce las dos características, tú produces el precio predicho por metro cuadrado del espacio de oficina para cada caso de prueba.


## Soluciones

<details>
    <summary>Pseudocódigo</summary>

- Leer datos de entrenamiento con características y precios conocidos
- Probar diferentes grados polinómicos (1, 2, 3) para encontrar el mejor modelo
- Usar el mejor modelo para predecir precios de casos de prueba

```text
Algorithm 1 (Principal)
├── Para cada grado (1,2,3):
│   ├── Llama transform_polynomial_features() para entrenar
│   ├── Resuelve mínimos cuadrados
│   └── Llama calculate_r_squared() para evaluar
├── Selecciona mejor modelo
└── Para cada caso de prueba:
    ├── Llama transform_polynomial_features() para predecir
    └── Calcula predicción final
```

```text
Algorithm 1: Regresión Polinómica para Predicción de Precios de Oficinas
Input: F (número de características), N (datos de entrenamiento), T (casos de prueba)
Output: Precios predichos para T casos de prueba

01: F, N ← read input parameters                     // leer parámetros de entrada
02: X_train ← [], y_train ← []                       // inicializar datos de entrenamiento
03: for i = 1 to N do                                // para cada observación
04:    data ← read F+1 values                        // leer características y precio
05:    X_train ← X_train + [data[0:F-1]]             // agregar características (índices 0 a F-1)
06:    y_train ← y_train + [data[F]]                 // agregar precio objetivo (índice F)
07: end for
08: 
09: best_model ← null, best_score ← -1                                   // inicializar mejor modelo
10: for degree d = 1 to 3 do                                             // probar grados polinómicos 1,2,3
11:    poly_features ← transform_polynomial_features(X_train, d)         // llamar Function 1
12:    coefficients ← solve_least_squares(poly_features, y_train)        // resolver mínimos cuadrados
13:    score ← calculate_r_squared(coefficients, poly_features, y_train) // llamar Function 2
14:    if score > best_score then                                        // si es mejor modelo
15:       best_score ← score, best_model ← coefficients                  // actualizar mejor modelo
16:       best_degree ← d                                                // guardar mejor grado
17:    end if
18: end for
19:
20: T ← read number of test cases                                              // leer casos de prueba
21: for i = 1 to T do                                                          // para cada caso de prueba
22:    x_test ← read F values                                                  // leer características de prueba
23:    test_poly_features ← transform_polynomial_features(x_test, best_degree) // llamar Function 1
24:    prediction ← dot_product(test_poly_features, best_model)                // hacer predicción
25:    print prediction (rounded to 2 decimals)                                // imprimir resultado
26: end for
``` 


```text
Function 1: transform_polynomial_features
Input: x (array de características), degree (grado polinómico)
Output: Array de características polinómicas transformadas

function transform_polynomial_features(x, degree)
01: poly_features ← [1]                                        // término de sesgo (constante)
02: num_features ← length(x)                                   // obtener número de características
03: for j = 1 to num_features do                               // términos lineales
04:    poly_features ← poly_features + [x[j-1]]                // agregar x_j (índice j-1)
05: end for
06:
07: if degree >= 2 then                                        // si grado >= 2
08:    for j = 1 to num_features do                            // términos cuadráticos
09:       poly_features ← poly_features + [x[j-1] * x[j-1]]    // agregar x_j²
10:    end for
11:   for j = 1 to num_features do                             // términos de interacción
12:      for k = j+1 to num_features do                        // evitar duplicados
13:         poly_features ← poly_features + [x[j-1] * x[k-1]]  // agregar x_j * x_k
14:      end for
15:   end for
16: end if
17:
18: if degree >= 3 then                                                   // si grado >= 3
19:    for j = 1 to num_features do                                       // términos cúbicos
20:       poly_features ← poly_features + [x[j-1] * x[j-1] * x[j-1]]      // agregar x_j³
21:    end for
22:    for j = 1 to num_features do                                       // términos de interacción cúbica
23:       for k = j+1 to num_features do                                  // x_j² * x_k
24:          poly_features ← poly_features + [x[j-1] * x[j-1] * x[k-1]]
25:       end for
26:       for k = j+1 to num_features do                                  // x_j * x_k²
27:          poly_features ← poly_features + [x[j-1] * x[k-1] * x[k-1]]
28:       end for
29:    end for
30: end if
31:
32: return poly_features                                                  // devolver vector transformado
end function
```

```text
Function 2: calculate_r_squared
Input: Coeficientes del modelo, matriz de características, valores reales
Output: Puntuación R² (entre 0 y 1)

function calculate_r_squared(coefficients, features, true_values)
1: predictions ← matrix_multiply(features, coefficients)    // calcular predicciones
2: mean_y ← calculate_mean(true_values)                     // calcular media de valores reales
3: residual_sum ← 0                                         // inicializar suma residual
4: total_sum ← 0                                            // inicializar suma total
5: n ← length(true_values)                                  // número de observaciones
6: for i = 1 to n do                                        // para cada valor
7:    diff_pred ← true_values[i-1] - predictions[i-1]       // diferencia predicción
8:    diff_mean ← true_values[i-1] - mean_y                 // diferencia con media
9:    residual_sum ← residual_sum + (diff_pred * diff_pred) // suma cuadrados residual
10:   total_sum ← total_sum + (diff_mean * diff_mean)       // suma cuadrados total
11: end for
12: if total_sum = 0 then                                   // evitar división por cero
13:    r_squared ← 1                                        // modelo perfecto
14: else
15:    r_squared ← 1 - (residual_sum / total_sum)           // coeficiente de determinación
16: end if
17: return r_squared                                        // devolver puntuación
end function
```
</details>

<details>
    <summary>Python</summary>
```python
import numpy as np
from sklearn.preprocessing import PolynomialFeatures
from sklearn.linear_model import LinearRegression
from sklearn.pipeline import Pipeline

def polynomial_regression_office_prices():
    # Leer entrada
    line = input().split()
    F = int(line[0])  # Número de características
    N = int(line[1])  # Número de datos de entrenamiento
    
    # Leer datos de entrenamiento
    X_train = []
    y_train = []
    
    for _ in range(N):
        data = list(map(float, input().split()))
        features = data[:F]  # Primeras F columnas son características
        price = data[F]      # Última columna es el precio
        X_train.append(features)
        y_train.append(price)
    
    X_train = np.array(X_train)
    y_train = np.array(y_train)
    
    # Crear modelo de regresión polinómica
    # Probamos diferentes grados (1, 2, 3) ya que el problema dice que es < 4
    best_model = None
    best_score = -1
    
    for degree in range(1, 4):
        # Pipeline con transformación polinómica y regresión lineal
        model = Pipeline([
            ('poly', PolynomialFeatures(degree=degree, include_bias=True)),
            ('linear', LinearRegression())
        ])
        
        # Entrenar modelo
        model.fit(X_train, y_train)
        
        # Evaluar en datos de entrenamiento (como medida simple)
        score = model.score(X_train, y_train)
        
        if score > best_score:
            best_score = score
            best_model = model
    
    # Leer casos de prueba
    T = int(input())
    
    # Predecir para cada caso de prueba
    for _ in range(T):
        test_features = list(map(float, input().split()))
        test_features = np.array(test_features).reshape(1, -1)
        
        # Hacer predicción
        prediction = best_model.predict(test_features)[0]
        
        # Imprimir resultado con 2 decimales
        print(f"{prediction:.2f}")

if __name__ == "__main__":
    polynomial_regression_office_prices()
```
</details>
